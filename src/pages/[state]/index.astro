---
import Layout from "~/layouts/Layout.astro";
import locations from "~/data/locations.json";

// --- GET STATIC PATHS ---
export async function getStaticPaths() {
    const allPages = [];

    // Process states
    for (const state of locations.states) {
        allPages.push({
            params: { state: state.slug },
            props: {
                stateName: state.name,
                stateSlug: state.slug,
                cities: state.cities,
                isUnionTerritory: false,
            },
        });
    }

    // Process union territories
    for (const ut of locations.unionTerritories) {
        allPages.push({
            params: { state: ut.slug },
            props: {
                stateName: ut.name,
                stateSlug: ut.slug,
                cities: ut.cities,
                isUnionTerritory: true,
            },
        });
    }

    return allPages;
}

const { stateName, stateSlug, cities, isUnionTerritory } = Astro.props;

// Get a representative image from the first city with an image
const heroImage =
    cities.find((c) => c.imageUrl)?.imageUrl ||
    "https://images.unsplash.com/photo-1524492412937-b28074a5d7da?auto=format&fit=crop&q=80&w=1200";

// Base URL for schema
const siteUrl = "https://www.whereinindia.online";

// Breadcrumb schema for state page
const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "Home",
            item: siteUrl,
        },
        {
            "@type": "ListItem",
            position: 2,
            name: stateName,
            item: `${siteUrl}/${stateSlug}`,
        },
    ],
};
---

<Layout
    title={`${stateName} Travel Guide: Explore Cities & Destinations`}
    description={`Discover the best cities and destinations in ${stateName}. Explore curated travel guides for ${cities.map((c) => c.name).join(", ")} and more.`}
    ogImage={heroImage}
>
    <!-- BreadcrumbList Schema -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />

    <main>
        <header class="hero">
            <div
                class="hero-image hero-image-city"
                style={`background-image: url(${heroImage});`}
            >
            </div>
            <div class="hero-text">
                <h1>Where to Go in {stateName}?</h1>
                <p>
                    {cities.length}
                    {cities.length === 1 ? "city" : "cities"} with trusted local guides
                </p>
            </div>
        </header>

        <section class="main-content">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <ol>
                    <li>
                        <a href="/">Home</a>
                        <span class="separator" aria-hidden="true">â€º</span>
                    </li>
                    <li aria-current="page">
                        <span>{stateName}</span>
                    </li>
                </ol>
            </nav>

            <div class="cities-grid">
                {
                    cities.map((city) => (
                        <a
                            href={`/${stateSlug}/${city.slug}`}
                            class="city-card"
                        >
                            <div
                                class="city-card-image"
                                style={`background-image: url(${city.imageUrl || "https://placehold.co/400x300/eee/999?text=" + city.name});`}
                            />
                            <div class="city-card-content">
                                <h2>{city.name}</h2>
                                {city.dashboard?.bestTime && (
                                    <span class="city-meta">
                                        Best time: {city.dashboard.bestTime}
                                    </span>
                                )}
                            </div>
                        </a>
                    ))
                }
            </div>
        </section>
    </main>
</Layout>

<style>
    /* Breadcrumbs */
    .breadcrumbs {
        padding: 0.5rem 0;
        font-size: 0.75rem;
        color: #666;
        margin-bottom: 1.5rem;
    }

    .breadcrumbs ol {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        list-style: none;
        margin: 0;
        padding: 0;
        gap: 0.25rem;
    }

    .breadcrumbs li {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .breadcrumbs a {
        color: #555;
        text-decoration: none;
    }

    .breadcrumbs a:hover {
        color: #000;
        text-decoration: underline;
    }

    .breadcrumbs .separator {
        color: #aaa;
    }

    .breadcrumbs li[aria-current="page"] span {
        color: #888;
    }

    /* Cities Grid */
    .cities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .city-card {
        display: block;
        background: #fff;
        border: 1px solid #e2e2e2;
        border-radius: 8px;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        transition:
            transform 0.2s ease,
            box-shadow 0.2s ease;
    }

    .city-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    .city-card-image {
        height: 180px;
        background-size: cover;
        background-position: center;
    }

    .city-card-content {
        padding: 1rem;
    }

    .city-card h2 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: #1a1a1a;
    }

    .city-meta {
        font-size: 0.8rem;
        color: #888;
    }

    /* Back Link */
    .back-link {
        text-align: center;
        padding-top: 1rem;
        border-top: 1px solid #e2e2e2;
    }

    .back-link a {
        color: #555;
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.2s ease;
    }

    .back-link a:hover {
        color: #000;
    }

    /* Responsive */
    @media (min-width: 640px) {
        .breadcrumbs {
            font-size: 0.8rem;
        }
    }
</style>
